from ..scripts import workflow


def build_multi(single_wf: dict, multi_params=['param_card']):
    """
    Convert single-step stage workflow to multistep stages

    :param single_wf: workflow represented as dictionary
    :param multi_params: names of parameters that will take multiple inputs
    :return: new multistep workflow dictionary
    """
    params = workflow.get_inputs(single_wf)

    for i in params:
        if i in multi_params:
            params['flatten'] = True

    multi_wf = {'stages': [{
        'dependencies': ['init'],
        'name': 'multi_' + '_'.join([i['name'] for i in single_wf['stages']]),
        'scheduler': {
            'parameters': params
        },
        'scheduler_type': 'multistep-stage',
        'scatter': {'method': 'zip', 'parameters': multi_params},
        'workflow': single_wf
    }]}
    return multi_wf


